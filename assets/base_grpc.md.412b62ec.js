import{_ as s,c as a,o as n,a as l}from"./app.0c99884c.js";const i=JSON.parse('{"title":"gRPC","description":"","frontmatter":{},"headers":[{"level":2,"title":"什么是 gRPC","slug":"什么是-grpc","link":"#什么是-grpc","children":[]},{"level":2,"title":"什么是 protobuf","slug":"什么是-protobuf","link":"#什么是-protobuf","children":[]},{"level":2,"title":"gRPC 环境搭建","slug":"grpc-环境搭建","link":"#grpc-环境搭建","children":[{"level":3,"title":"安装 protoc","slug":"安装-protoc","link":"#安装-protoc","children":[]},{"level":3,"title":"安装 grpc-go","slug":"安装-grpc-go","link":"#安装-grpc-go","children":[]}]},{"level":2,"title":"编写 proto 文件","slug":"编写-proto-文件","link":"#编写-proto-文件","children":[]},{"level":2,"title":"protobuf 和 json 对比","slug":"protobuf-和-json-对比","link":"#protobuf-和-json-对比","children":[]}],"relativePath":"base/grpc.md"}'),o={name:"base/grpc.md"},p=l(`<h1 id="grpc" tabindex="-1">gRPC <a class="header-anchor" href="#grpc" aria-hidden="true">#</a></h1><h2 id="什么是-grpc" tabindex="-1">什么是 gRPC <a class="header-anchor" href="#什么是-grpc" aria-hidden="true">#</a></h2><p><a href="https://grpc.io" target="_blank" rel="noreferrer">gRPC</a> 是一个高性能、开源和通用的 RPC 框架，面向移动和 HTTP/2 设计的。目前提供 C、Java 和 Go 语言版本，分别是：<a href="https://github.com/grpc/grpc" target="_blank" rel="noreferrer">grpc</a> 、 <a href="https://github.com/grpc/grpc-java" target="_blank" rel="noreferrer">grpc-java</a> 、 <a href="https://github.com/grpc/grpc-go" target="_blank" rel="noreferrer">grpc-go</a> 。其中 C 版本支持 C 、 C++ 、 Node.js 、 Python 、 Ruby 、 Objective-C 、 PHP 和 C# 支持.</p><p>gRPC 文档地址 <a href="https://grpc.io/docs/" target="_blank" rel="noreferrer">https://grpc.io/docs/</a></p><p>go gRPC 文档地址 <a href="https://grpc.io/docs/languages/go/quickstart/" target="_blank" rel="noreferrer">https://grpc.io/docs/languages/go/quickstart/</a></p><h2 id="什么是-protobuf" tabindex="-1">什么是 protobuf <a class="header-anchor" href="#什么是-protobuf" aria-hidden="true">#</a></h2><p><a href="https://protobuf.dev" target="_blank" rel="noreferrer">Protocol Buffer</a> （又名 protobuf） 是 Google出品的一种轻量高效的结构化数据存储格式。支持多种不同的编程语言</p><p>protobuf 的优点</p><ul><li>性能 <ul><li>压缩性好</li><li>序列化和反序列化快 (比 json 、xml 快 2-100 倍)</li><li>传输速度快</li></ul></li><li>便携性 <ul><li>使用简单 （自动序列化和反序列化）</li><li>维护成本低 （只维护 proto 文件）</li><li>向后兼容</li><li>加密性好</li></ul></li><li>跨语言</li></ul><p>缺点</p><ul><li>通用性差 （需要专门的 protobuf 库解析）</li><li>自解释性差 （只能通过 proto 文件才能了解数据结构）</li></ul><h2 id="grpc-环境搭建" tabindex="-1">gRPC 环境搭建 <a class="header-anchor" href="#grpc-环境搭建" aria-hidden="true">#</a></h2><h3 id="安装-protoc" tabindex="-1">安装 protoc <a class="header-anchor" href="#安装-protoc" aria-hidden="true">#</a></h3><p>打开 <a href="https://github.com/protocolbuffers/protobuf/releases" target="_blank" rel="noreferrer">https://github.com/protocolbuffers/protobuf/releases</a> ，下载指定的版本就可以了</p><p>Win 下面需要配置环境变量 ，将下载的 protobuf 文件中的 bin 目录下 protoc.exe 的添加到环境变量中</p><ul><li>鼠标右键此电脑属性</li><li>点击 系统 -&gt; 高级系统设置 -&gt; 环境变量</li><li>点击系统变量中的 Path, 将 bin 目录添加的环境变量中</li></ul><h3 id="安装-grpc-go" tabindex="-1">安装 grpc-go <a class="header-anchor" href="#安装-grpc-go" aria-hidden="true">#</a></h3><p>可以参考 <a href="https://grpc.io/docs/languages/go/quickstart/" target="_blank" rel="noreferrer">https://grpc.io/docs/languages/go/quickstart/</a> 进行安装</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">go</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">google.golang.org/protobuf/cmd/protoc-gen-go@v1.</span><span style="color:#F78C6C;">28</span></span>
<span class="line"><span style="color:#FFCB6B;">go</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">google.golang.org/grpc/cmd/protoc-gen-go-grpc@v1.</span><span style="color:#F78C6C;">2</span></span>
<span class="line"></span></code></pre></div><p>然后需要配置下环境变量</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">export</span><span style="color:#A6ACCD;"> PATH</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">$PATH</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">go</span><span style="color:#C3E88D;"> env GOPATH</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">/bin</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><h2 id="编写-proto-文件" tabindex="-1">编写 proto 文件 <a class="header-anchor" href="#编写-proto-文件" aria-hidden="true">#</a></h2><div class="language-proto"><button title="Copy Code" class="copy"></button><span class="lang">proto</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">syntax</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;proto3&quot;</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 指定使用的proto版本</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">option</span><span style="color:#A6ACCD;"> go_package </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;./;hello&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">message</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">HelloRequest</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">string</span><span style="color:#A6ACCD;"> name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 1 是编号不是值</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">int32</span><span style="color:#A6ACCD;"> age </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//   2 编号</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>编译 proto 文件</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">protoc</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--go_out=.</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--go_opt=paths=source_relative</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">--go-grpc_out=. </span><span style="color:#C3E88D;">--go-grpc_opt=paths=source_relative</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">hello.proto</span></span>
<span class="line"></span></code></pre></div><p>会生成一个 hello.pb.go 文件</p><h2 id="protobuf-和-json-对比" tabindex="-1">protobuf 和 json 对比 <a class="header-anchor" href="#protobuf-和-json-对比" aria-hidden="true">#</a></h2><p>导入上面生成的 hello.pb.go 文件</p><div class="language-go"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">package</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">encoding/json</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">fmt</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">github.com/golang/protobuf/proto</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">	hello </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">rpc_demo/protobuf</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">func</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	req </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> hello</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">HelloRequest</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		Name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">shibin</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">		Age</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">     </span><span style="color:#F78C6C;">17</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">		Courses</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#C792EA;">string</span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">go</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">gin</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> _ </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> proto</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Marshal</span><span style="color:#89DDFF;">(&amp;</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#676E95;font-style:italic;">// res, _ := json.Marshal(&amp;req)</span></span>
<span class="line"><span style="color:#A6ACCD;">	fmt</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Println</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// // 19</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	req1 </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> hello</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">HelloRequest</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		Name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">shibin</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">		Age</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">     </span><span style="color:#F78C6C;">17</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">		Courses</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#C792EA;">string</span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">go</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">gin</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	jsonRes</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> _ </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> json</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Marshal</span><span style="color:#89DDFF;">(&amp;</span><span style="color:#A6ACCD;">req1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	fmt</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Println</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">jsonRes</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 49</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>通过打印长度，可以发现 protobuf 比 json 长度少了一倍多</p><div class="language-go"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">	newReq </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> hello</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">HelloRequest</span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#A6ACCD;">	_ </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> proto</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Unmarshal</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">newReq</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	fmt</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">newReq</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> newReq</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Age</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> newReq</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Courses</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>protobuf 反序列化</p><div class="language-go"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">package</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">fmt</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">github.com/golang/protobuf/proto</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">	hello </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">rpc_demo/protobuf</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">func</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	req </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> hello</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">HelloRequest</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		Name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">shibin</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">		Age</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">     </span><span style="color:#F78C6C;">17</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">		Courses</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#C792EA;">string</span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">go</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">gin</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> _ </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> proto</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Marshal</span><span style="color:#89DDFF;">(&amp;</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	newReq </span><span style="color:#89DDFF;">:=</span><span style="color:#A6ACCD;"> hello</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">HelloRequest</span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#A6ACCD;">	_ </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> proto</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Unmarshal</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">newReq</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	fmt</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">newReq</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> newReq</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Age</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> newReq</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Courses</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// shibin 17 [go gin]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div>`,33),e=[p];function t(r,c,D,F,y,C){return n(),a("div",null,e)}const g=s(o,[["render",t]]);export{i as __pageData,g as default};
